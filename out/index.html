<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""
    />
    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin=""
    ></script>
    <style>
      body {
        margin: 0;
      }
      #map {
        height: 100vh;
        background: #000;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <script>
      const stringToColor = (value) => {
        let hash = 0;
        for (let i = 0; i < value.length; i++) {
          hash = value.charCodeAt(i) + ((hash << 5) - hash);
        }

        return `hsl(${hash % 360}, 65%, 50%)`;
      };

      const SCALE = 1.0666667222976685;
      const DEG_45 = Math.PI / 4; // 45 degrees in radians

      const worldCRS = L.extend({}, L.CRS.Simple, {
        // transformation: new L.Transformation(SCALE , 0, -SCALE, 0),
      });

      const map = L.map("map", {
        crs: worldCRS,
        minZoom: -20,
      });
      L.tileLayer("https://diablo4.th.gl/map_tiles/{z}/{y}/{x}.jpg", {
        tileSize: 512,
        minNativeZoom: 0,
        maxNativeZoom: 5,
      }).addTo(map);

      fetch("nodes.json")
        .then((response) => response.json())
        .then((nodes) => {
          nodes.forEach((node) => {
            L.circleMarker(node.point, {
              radius: 2,
              color: stringToColor(node.actor),
            })
              .bindTooltip(
                `${node.name || "None"}<br/>${node.actor}<br/>${
                  node.world
                }<br/>${node.id}`
              )
              .addTo(map);
          });

          fetch("territories.json")
            .then((response) => response.json())
            .then((territories) => {
              territories.forEach((territory) => {
                const polygons = L.polygon(territory.points, {
                  color: "lightblue",
                  fill: false,
                  weight: 2,
                });
                polygons.addTo(map);

                map.fitBounds([
                  [0, 0],
                  [-300, 300],
                ]);
              });
            });
        });
    </script>
  </body>
</html>
